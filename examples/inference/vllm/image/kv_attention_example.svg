<?xml version="1.0" encoding="UTF-8" standalone="no"?>
<!DOCTYPE svg PUBLIC "-//W3C//DTD SVG 1.1//EN"
 "http://www.w3.org/Graphics/SVG/1.1/DTD/svg11.dtd">
<!-- Generated by graphviz version 14.0.2 (20251019.1705)
 -->
<!-- Title: KVAttention Pages: 1 -->
<svg width="2592pt" height="473pt"
 viewBox="0.00 0.00 2592.00 473.00" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink">
<g id="graph0" class="graph" transform="scale(0.37369 0.37369) rotate(0) translate(4 1262.77)">
<title>KVAttention</title>
<polygon fill="white" stroke="none" points="-4,4 -4,-1262.77 6932.23,-1262.77 6932.23,4 -4,4"/>
<g id="clust1" class="cluster">
<title>cluster_kvcache</title>
<polygon fill="none" stroke="black" stroke-dasharray="5,2" points="2688.69,-160.4 2688.69,-917.4 3119.44,-917.4 3119.44,-160.4 2688.69,-160.4"/>
<text xml:space="preserve" text-anchor="middle" x="2904.06" y="-879.2" font-family="Arial" font-size="36.00">KV Cache (after 3 tokens)</text>
</g>
<!-- PromptBox -->
<g id="node1" class="node">
<title>PromptBox</title>
<polygon fill="#fff7cc" stroke="black" points="476.38,-557.6 127.38,-557.6 127.38,-471.2 476.38,-471.2 476.38,-557.6"/>
<text xml:space="preserve" text-anchor="middle" x="301.88" y="-500.82" font-family="Arial" font-size="36.00">Prompt: how are you</text>
</g>
<!-- InputTokens -->
<g id="node2" class="node">
<title>InputTokens</title>
<polygon fill="#ffe4b2" stroke="none" points="1483.25,-449.27 1483.25,-579.52 1550.5,-579.52 1550.5,-449.27 1483.25,-449.27"/>
<polygon fill="none" stroke="black" points="1484.25,-535.77 1484.25,-578.52 1549.5,-578.52 1549.5,-535.77 1484.25,-535.77"/>
<text xml:space="preserve" text-anchor="start" x="1487.25" y="-545.12" font-family="Arial" font-size="32.00">how</text>
<polygon fill="none" stroke="black" points="1484.25,-493.02 1484.25,-535.77 1549.5,-535.77 1549.5,-493.02 1484.25,-493.02"/>
<text xml:space="preserve" text-anchor="start" x="1493.62" y="-502.37" font-family="Arial" font-size="32.00">are</text>
<polygon fill="none" stroke="black" points="1484.25,-450.27 1484.25,-493.02 1549.5,-493.02 1549.5,-450.27 1484.25,-450.27"/>
<text xml:space="preserve" text-anchor="start" x="1491" y="-459.62" font-family="Arial" font-size="32.00">you</text>
<polygon fill="none" stroke="black" points="1483.25,-449.27 1483.25,-579.52 1550.5,-579.52 1550.5,-449.27 1483.25,-449.27"/>
</g>
<!-- PromptBox&#45;&gt;InputTokens -->
<g id="edge1" class="edge">
<title>PromptBox&#45;&gt;InputTokens</title>
<path fill="none" stroke="black" d="M476.67,-514.4C742.1,-514.4 1238.24,-514.4 1433.71,-514.4"/>
<polygon fill="black" stroke="black" points="1433.51,-517.9 1443.51,-514.4 1433.51,-510.9 1433.51,-517.9"/>
<text xml:space="preserve" text-anchor="middle" x="674.25" y="-519.3" font-family="Arial" font-size="28.00">tokenize</text>
</g>
<!-- E0 -->
<g id="node3" class="node">
<title>E0</title>
<ellipse fill="#b2e4ff" stroke="black" cx="2471.49" cy="-682.4" rx="145.49" ry="57.63"/>
<text xml:space="preserve" text-anchor="middle" x="2471.49" y="-688.75" font-family="Arial" font-size="32.00">Embedding 0</text>
<text xml:space="preserve" text-anchor="middle" x="2471.49" y="-652" font-family="Arial" font-size="32.00">[how]</text>
</g>
<!-- InputTokens&#45;&gt;E0 -->
<g id="edge2" class="edge">
<title>InputTokens:how&#45;&gt;E0</title>
<path fill="none" stroke="black" d="M1550.5,-557.15C1830.36,-557.15 2153.76,-614.75 2332.92,-651.83"/>
<polygon fill="black" stroke="black" points="2332,-655.21 2342.51,-653.82 2333.43,-648.36 2332,-655.21"/>
</g>
<!-- E1 -->
<g id="node4" class="node">
<title>E1</title>
<ellipse fill="#b2e4ff" stroke="black" cx="2471.49" cy="-514.4" rx="145.49" ry="57.63"/>
<text xml:space="preserve" text-anchor="middle" x="2471.49" y="-520.75" font-family="Arial" font-size="32.00">Embedding 1</text>
<text xml:space="preserve" text-anchor="middle" x="2471.49" y="-484" font-family="Arial" font-size="32.00">[are]</text>
</g>
<!-- InputTokens&#45;&gt;E1 -->
<g id="edge3" class="edge">
<title>InputTokens:are&#45;&gt;E1</title>
<path fill="none" stroke="black" d="M1550.5,-514.4C1819,-514.4 2131.57,-514.4 2314.56,-514.4"/>
<polygon fill="black" stroke="black" points="2314.37,-517.9 2324.37,-514.4 2314.37,-510.9 2314.37,-517.9"/>
</g>
<!-- E2 -->
<g id="node5" class="node">
<title>E2</title>
<ellipse fill="#b2e4ff" stroke="black" cx="2471.49" cy="-346.4" rx="145.49" ry="57.63"/>
<text xml:space="preserve" text-anchor="middle" x="2471.49" y="-352.75" font-family="Arial" font-size="32.00">Embedding 2</text>
<text xml:space="preserve" text-anchor="middle" x="2471.49" y="-316" font-family="Arial" font-size="32.00">[you]</text>
</g>
<!-- InputTokens&#45;&gt;E2 -->
<g id="edge4" class="edge">
<title>InputTokens:you&#45;&gt;E2</title>
<path fill="none" stroke="black" d="M1550.5,-471.65C1830.36,-471.65 2153.76,-414.04 2332.92,-376.96"/>
<polygon fill="black" stroke="black" points="2333.43,-380.43 2342.51,-374.97 2332,-373.58 2333.43,-380.43"/>
</g>
<!-- KVTable -->
<g id="node7" class="node">
<title>KVTable</title>
<polygon fill="#ffffff" stroke="none" points="2817.69,-172.4 2817.69,-856.4 2989.44,-856.4 2989.44,-172.4 2817.69,-172.4"/>
<polygon fill="#e6b2ff" stroke="none" points="2828.69,-743.4 2828.69,-845.4 2978.44,-845.4 2978.44,-743.4 2828.69,-743.4"/>
<polygon fill="none" stroke="black" points="2828.69,-743.4 2828.69,-845.4 2978.44,-845.4 2978.44,-743.4 2828.69,-743.4"/>
<text xml:space="preserve" text-anchor="start" x="2855.19" y="-799.2" font-family="Arial" font-weight="bold" font-size="36.00">Key 0</text>
<text xml:space="preserve" text-anchor="start" x="2855.19" y="-759.4" font-family="Arial" font-size="40.00">[how]</text>
<polygon fill="#b2ffb2" stroke="none" points="2828.69,-631.4 2828.69,-733.4 2978.44,-733.4 2978.44,-631.4 2828.69,-631.4"/>
<polygon fill="none" stroke="black" points="2828.69,-631.4 2828.69,-733.4 2978.44,-733.4 2978.44,-631.4 2828.69,-631.4"/>
<text xml:space="preserve" text-anchor="start" x="2841.69" y="-687.2" font-family="Arial" font-weight="bold" font-size="36.00">Value 0</text>
<text xml:space="preserve" text-anchor="start" x="2855.19" y="-647.4" font-family="Arial" font-size="40.00">[how]</text>
<polygon fill="#e6b2ff" stroke="none" points="2828.69,-519.4 2828.69,-621.4 2978.44,-621.4 2978.44,-519.4 2828.69,-519.4"/>
<polygon fill="none" stroke="black" points="2828.69,-519.4 2828.69,-621.4 2978.44,-621.4 2978.44,-519.4 2828.69,-519.4"/>
<text xml:space="preserve" text-anchor="start" x="2855.19" y="-575.2" font-family="Arial" font-weight="bold" font-size="36.00">Key 1</text>
<text xml:space="preserve" text-anchor="start" x="2863.06" y="-535.4" font-family="Arial" font-size="40.00">[are]</text>
<polygon fill="#b2ffb2" stroke="none" points="2828.69,-407.4 2828.69,-509.4 2978.44,-509.4 2978.44,-407.4 2828.69,-407.4"/>
<polygon fill="none" stroke="black" points="2828.69,-407.4 2828.69,-509.4 2978.44,-509.4 2978.44,-407.4 2828.69,-407.4"/>
<text xml:space="preserve" text-anchor="start" x="2841.69" y="-463.2" font-family="Arial" font-weight="bold" font-size="36.00">Value 1</text>
<text xml:space="preserve" text-anchor="start" x="2863.06" y="-423.4" font-family="Arial" font-size="40.00">[are]</text>
<polygon fill="#e6b2ff" stroke="none" points="2828.69,-295.4 2828.69,-397.4 2978.44,-397.4 2978.44,-295.4 2828.69,-295.4"/>
<polygon fill="none" stroke="black" points="2828.69,-295.4 2828.69,-397.4 2978.44,-397.4 2978.44,-295.4 2828.69,-295.4"/>
<text xml:space="preserve" text-anchor="start" x="2855.19" y="-351.2" font-family="Arial" font-weight="bold" font-size="36.00">Key 2</text>
<text xml:space="preserve" text-anchor="start" x="2859.69" y="-311.4" font-family="Arial" font-size="40.00">[you]</text>
<polygon fill="#b2ffb2" stroke="none" points="2828.69,-183.4 2828.69,-285.4 2978.44,-285.4 2978.44,-183.4 2828.69,-183.4"/>
<polygon fill="none" stroke="black" points="2828.69,-183.4 2828.69,-285.4 2978.44,-285.4 2978.44,-183.4 2828.69,-183.4"/>
<text xml:space="preserve" text-anchor="start" x="2841.69" y="-239.2" font-family="Arial" font-weight="bold" font-size="36.00">Value 2</text>
<text xml:space="preserve" text-anchor="start" x="2859.69" y="-199.4" font-family="Arial" font-size="40.00">[you]</text>
<polygon fill="none" stroke="black" points="2817.69,-172.4 2817.69,-856.4 2989.44,-856.4 2989.44,-172.4 2817.69,-172.4"/>
</g>
<!-- E0&#45;&gt;KVTable -->
<g id="edge5" class="edge">
<title>E0&#45;&gt;KVTable:k0</title>
<path fill="none" stroke="black" d="M2562.76,-727.63C2630.31,-757.47 2726.2,-791.54 2816.43,-794.23"/>
<polygon fill="black" stroke="black" points="2816.12,-797.72 2826.17,-794.37 2816.23,-790.72 2816.12,-797.72"/>
</g>
<!-- E0&#45;&gt;KVTable -->
<g id="edge6" class="edge">
<title>E0&#45;&gt;KVTable:v0</title>
<path fill="none" stroke="black" d="M2617.22,-682.4C2678.13,-682.4 2750.1,-682.4 2816.26,-682.4"/>
<polygon fill="black" stroke="black" points="2816.17,-685.9 2826.17,-682.4 2816.17,-678.9 2816.17,-685.9"/>
</g>
<!-- E1&#45;&gt;KVTable -->
<g id="edge7" class="edge">
<title>E1&#45;&gt;KVTable:k1</title>
<path fill="none" stroke="black" d="M2597.08,-543.79C2661.55,-556.65 2742.12,-569.12 2816.31,-570.3"/>
<polygon fill="black" stroke="black" points="2816.14,-573.8 2826.17,-570.38 2816.2,-566.8 2816.14,-573.8"/>
</g>
<!-- E1&#45;&gt;KVTable -->
<g id="edge8" class="edge">
<title>E1&#45;&gt;KVTable:v1</title>
<path fill="none" stroke="black" d="M2597.08,-485C2661.55,-472.14 2742.12,-459.67 2816.31,-458.49"/>
<polygon fill="black" stroke="black" points="2816.2,-461.99 2826.17,-458.41 2816.14,-454.99 2816.2,-461.99"/>
</g>
<!-- E2&#45;&gt;KVTable -->
<g id="edge9" class="edge">
<title>E2&#45;&gt;KVTable:k2</title>
<path fill="none" stroke="black" d="M2617.22,-346.4C2678.13,-346.4 2750.1,-346.4 2816.26,-346.4"/>
<polygon fill="black" stroke="black" points="2816.17,-349.9 2826.17,-346.4 2816.17,-342.9 2816.17,-349.9"/>
</g>
<!-- E2&#45;&gt;KVTable -->
<g id="edge10" class="edge">
<title>E2&#45;&gt;KVTable:v2</title>
<path fill="none" stroke="black" d="M2562.76,-301.16C2630.31,-271.32 2726.2,-237.25 2816.43,-234.56"/>
<polygon fill="black" stroke="black" points="2816.23,-238.07 2826.17,-234.42 2816.12,-231.07 2816.23,-238.07"/>
</g>
<!-- Qgen -->
<g id="node6" class="node">
<title>Qgen</title>
<ellipse fill="#ffd1dc" stroke="black" cx="2903.56" cy="-107.4" rx="249.59" ry="43.2"/>
<text xml:space="preserve" text-anchor="middle" x="2903.56" y="-95.37" font-family="Arial" font-size="32.00">Query (for next output token)</text>
</g>
<!-- Q2K0 -->
<g id="node8" class="node">
<title>Q2K0</title>
<polygon fill="#e0e0ff" stroke="black" points="3377.15,-550.9 3190.15,-469.4 3377.15,-387.9 3564.15,-469.4 3377.15,-550.9"/>
<text xml:space="preserve" text-anchor="middle" x="3377.15" y="-475.75" font-family="Arial" font-size="32.00">Dot(Q2, K0)</text>
<text xml:space="preserve" text-anchor="middle" x="3377.15" y="-439" font-family="Arial" font-size="32.00">= score 0</text>
</g>
<!-- Qgen&#45;&gt;Q2K0 -->
<g id="edge11" class="edge">
<title>Qgen&#45;&gt;Q2K0</title>
<path fill="none" stroke="black" d="M3117.66,-129.82C3130.7,-136.91 3142.73,-145.66 3153.15,-156.4 3188.13,-192.45 3160.06,-339.17 3190.15,-379.4 3206.67,-401.49 3230.05,-418.43 3254.68,-431.32"/>
<polygon fill="black" stroke="black" points="3253.05,-434.41 3263.56,-435.74 3256.17,-428.15 3253.05,-434.41"/>
</g>
<!-- Q2K1 -->
<g id="node9" class="node">
<title>Q2K1</title>
<polygon fill="#e0e0ff" stroke="black" points="3377.15,-369.9 3190.15,-288.4 3377.15,-206.9 3564.15,-288.4 3377.15,-369.9"/>
<text xml:space="preserve" text-anchor="middle" x="3377.15" y="-294.75" font-family="Arial" font-size="32.00">Dot(Q2, K1)</text>
<text xml:space="preserve" text-anchor="middle" x="3377.15" y="-258" font-family="Arial" font-size="32.00">= score 1</text>
</g>
<!-- Qgen&#45;&gt;Q2K1 -->
<g id="edge13" class="edge">
<title>Qgen&#45;&gt;Q2K1</title>
<path fill="none" stroke="black" d="M3102.33,-133.79C3120.09,-139.86 3137.32,-147.3 3153.15,-156.4 3174.71,-168.79 3170.34,-183.35 3190.15,-198.4 3213.58,-216.19 3241.09,-231.83 3267.66,-244.85"/>
<polygon fill="black" stroke="black" points="3265.89,-247.89 3276.42,-249.06 3268.92,-241.58 3265.89,-247.89"/>
</g>
<!-- Q2K2 -->
<g id="node10" class="node">
<title>Q2K2</title>
<polygon fill="#e0e0ff" stroke="black" points="3377.15,-188.9 3190.15,-107.4 3377.15,-25.9 3564.15,-107.4 3377.15,-188.9"/>
<text xml:space="preserve" text-anchor="middle" x="3377.15" y="-113.75" font-family="Arial" font-size="32.00">Dot(Q2, K2)</text>
<text xml:space="preserve" text-anchor="middle" x="3377.15" y="-77" font-family="Arial" font-size="32.00">= score 2</text>
</g>
<!-- Qgen&#45;&gt;Q2K2 -->
<g id="edge15" class="edge">
<title>Qgen&#45;&gt;Q2K2</title>
<path fill="none" stroke="black" d="M3153.47,-107.4C3161.6,-107.4 3169.7,-107.4 3177.75,-107.4"/>
<polygon fill="black" stroke="black" points="3177.57,-110.9 3187.57,-107.4 3177.57,-103.9 3177.57,-110.9"/>
</g>
<!-- KVTable&#45;&gt;Q2K0 -->
<g id="edge12" class="edge">
<title>KVTable:k0&#45;&gt;Q2K0</title>
<path fill="none" stroke="black" d="M2979.44,-794.4C3136.9,-794.4 3266.14,-639.28 3331,-543.37"/>
<polygon fill="black" stroke="black" points="3333.77,-545.51 3336.42,-535.25 3327.95,-541.62 3333.77,-545.51"/>
</g>
<!-- KVTable&#45;&gt;Q2K1 -->
<g id="edge14" class="edge">
<title>KVTable:k1&#45;&gt;Q2K1</title>
<path fill="none" stroke="black" d="M2979.44,-570.4C3105.83,-570.4 3085.52,-450.31 3190.15,-379.4 3215.21,-362.4 3243.92,-346.74 3271.16,-333.37"/>
<polygon fill="black" stroke="black" points="3272.68,-336.53 3280.16,-329.02 3269.63,-330.23 3272.68,-336.53"/>
</g>
<!-- KVTable&#45;&gt;Q2K2 -->
<g id="edge16" class="edge">
<title>KVTable:k2&#45;&gt;Q2K2</title>
<path fill="none" stroke="black" d="M2979.44,-346.4C3093.88,-346.4 3091.62,-256.61 3190.15,-198.4 3216.75,-182.68 3246.45,-167.26 3274.18,-153.71"/>
<polygon fill="black" stroke="black" points="3275.46,-156.97 3282.93,-149.46 3272.4,-150.68 3275.46,-156.97"/>
</g>
<!-- WS -->
<g id="node12" class="node">
<title>WS</title>
<polygon fill="#e0ffe0" stroke="black" points="4295.23,-713.27 3915.48,-713.27 3915.48,-483.52 4301.23,-483.52 4301.23,-707.27 4295.23,-713.27"/>
<polyline fill="none" stroke="black" points="4295.23,-713.27 4295.23,-707.27"/>
<polyline fill="none" stroke="black" points="4301.23,-707.27 4295.23,-707.27"/>
<text xml:space="preserve" text-anchor="middle" x="4108.35" y="-678.87" font-family="Arial" font-size="32.00">Weighted sum:</text>
<text xml:space="preserve" text-anchor="middle" x="4108.35" y="-642.12" font-family="Arial" font-size="32.00">Softmax(score0) × V0 +</text>
<text xml:space="preserve" text-anchor="middle" x="4108.35" y="-605.37" font-family="Arial" font-size="32.00">Softmax(score1) × V1 +</text>
<text xml:space="preserve" text-anchor="middle" x="4108.35" y="-568.62" font-family="Arial" font-size="32.00">Softmax(score2) × V2</text>
<text xml:space="preserve" text-anchor="middle" x="4108.35" y="-493.87" font-family="Arial" font-size="32.00">WeightedSum = Σ w_i V_i</text>
</g>
<!-- KVTable&#45;&gt;WS -->
<g id="edge21" class="edge">
<title>KVTable:v0&#45;&gt;WS</title>
<path fill="none" stroke="black" d="M2979.44,-682.4C3388.08,-682.4 3491.11,-674.52 3897.48,-631.4 3899.55,-631.17 3901.64,-630.95 3903.74,-630.72"/>
<polygon fill="black" stroke="black" points="3903.99,-634.21 3913.52,-629.59 3903.19,-627.26 3903.99,-634.21"/>
</g>
<!-- KVTable&#45;&gt;WS -->
<g id="edge22" class="edge">
<title>KVTable:v1&#45;&gt;WS</title>
<path fill="none" stroke="black" d="M2979.44,-458.4C3083.48,-458.4 3089.24,-535.05 3190.15,-560.4 3320.21,-593.07 3675.62,-599.21 3903.91,-599.58"/>
<polygon fill="black" stroke="black" points="3903.84,-603.08 3913.84,-599.59 3903.85,-596.08 3903.84,-603.08"/>
</g>
<!-- KVTable&#45;&gt;WS -->
<g id="edge23" class="edge">
<title>KVTable:v2&#45;&gt;WS</title>
<path fill="none" stroke="black" d="M2979.44,-234.4C3163.68,-234.4 3024.69,-510.35 3190.15,-591.4 3252.29,-621.84 3652.93,-614.16 3903.73,-606.1"/>
<polygon fill="black" stroke="black" points="3903.79,-609.6 3913.67,-605.78 3903.56,-602.61 3903.79,-609.6"/>
</g>
<!-- SM -->
<g id="node11" class="node">
<title>SM</title>
<polygon fill="#ffe0e0" stroke="black" points="3878.48,-494.9 3657.89,-494.9 3601.15,-331.9 3821.73,-331.9 3878.48,-494.9"/>
<text xml:space="preserve" text-anchor="middle" x="3739.81" y="-419.75" font-family="Arial" font-size="32.00">Softmax</text>
<text xml:space="preserve" text-anchor="middle" x="3739.81" y="-383" font-family="Arial" font-size="32.00">(scores)</text>
</g>
<!-- Q2K0&#45;&gt;SM -->
<g id="edge17" class="edge">
<title>Q2K0&#45;&gt;SM</title>
<path fill="none" stroke="black" d="M3516.04,-447.98C3551.57,-442.47 3589.43,-436.59 3623.67,-431.27"/>
<polygon fill="black" stroke="black" points="3623.81,-434.79 3633.15,-429.8 3622.74,-427.88 3623.81,-434.79"/>
</g>
<!-- Q2K1&#45;&gt;SM -->
<g id="edge18" class="edge">
<title>Q2K1&#45;&gt;SM</title>
<path fill="none" stroke="black" d="M3481.98,-324.38C3519.81,-337.49 3563.14,-352.51 3603.31,-366.43"/>
<polygon fill="black" stroke="black" points="3601.97,-369.67 3612.56,-369.64 3604.26,-363.06 3601.97,-369.67"/>
</g>
<!-- Q2K2&#45;&gt;SM -->
<g id="edge19" class="edge">
<title>Q2K2&#45;&gt;SM</title>
<path fill="none" stroke="black" d="M3479.24,-144.93C3508.63,-158.86 3539.44,-176.68 3564.15,-198.4 3586.55,-218.09 3583.12,-230.62 3601.15,-254.4 3618.48,-277.26 3638.14,-301.06 3657.07,-323.08"/>
<polygon fill="black" stroke="black" points="3654.38,-325.32 3663.57,-330.6 3659.68,-320.75 3654.38,-325.32"/>
</g>
<!-- SM&#45;&gt;WS -->
<g id="edge20" class="edge">
<title>SM&#45;&gt;WS</title>
<path fill="none" stroke="black" d="M3873.92,-480.58C3884.08,-485.71 3894.47,-490.95 3904.94,-496.24"/>
<polygon fill="black" stroke="black" points="3903.15,-499.25 3913.65,-500.63 3906.3,-493 3903.15,-499.25"/>
</g>
<!-- LOGITS -->
<g id="node13" class="node">
<title>LOGITS</title>
<polygon fill="#e0f7fa" stroke="black" points="5088.23,-657.52 4589.23,-657.52 4589.23,-539.27 5088.23,-539.27 5088.23,-657.52"/>
<text xml:space="preserve" text-anchor="middle" x="4838.73" y="-623.12" font-family="Arial" font-size="32.00">Project to logits:</text>
<text xml:space="preserve" text-anchor="middle" x="4838.73" y="-586.37" font-family="Arial" font-size="32.00">logits = WeightedSum × W_vocab</text>
<text xml:space="preserve" text-anchor="middle" x="4838.73" y="-549.62" font-family="Arial" font-size="32.00">(1 score per vocab token)</text>
</g>
<!-- WS&#45;&gt;LOGITS -->
<g id="edge24" class="edge">
<title>WS&#45;&gt;LOGITS</title>
<path fill="none" stroke="black" d="M4301.68,-598.4C4386.14,-598.4 4486.6,-598.4 4577.6,-598.4"/>
<polygon fill="black" stroke="black" points="4577.42,-601.9 4587.42,-598.4 4577.42,-594.9 4577.42,-601.9"/>
</g>
<!-- ARGMAX -->
<g id="node14" class="node">
<title>ARGMAX</title>
<polygon fill="#f0e0fa" stroke="black" points="5513.23,-641.6 5125.23,-641.6 5125.23,-555.2 5513.23,-555.2 5513.23,-641.6"/>
<text xml:space="preserve" text-anchor="middle" x="5319.23" y="-604.75" font-family="Arial" font-size="32.00">Select output token:</text>
<text xml:space="preserve" text-anchor="middle" x="5319.23" y="-568" font-family="Arial" font-size="32.00">output_id = argmax(logits)</text>
</g>
<!-- LOGITS&#45;&gt;ARGMAX -->
<g id="edge25" class="edge">
<title>LOGITS&#45;&gt;ARGMAX</title>
<path fill="none" stroke="black" d="M5088.44,-598.4C5096.88,-598.4 5105.3,-598.4 5113.67,-598.4"/>
<polygon fill="black" stroke="black" points="5113.52,-601.9 5123.52,-598.4 5113.52,-594.9 5113.52,-601.9"/>
</g>
<!-- DETOK -->
<g id="node15" class="node">
<title>DETOK</title>
<polygon fill="#f0fff0" stroke="black" points="6159.48,-641.6 5550.23,-641.6 5550.23,-555.2 6159.48,-555.2 6159.48,-641.6"/>
<text xml:space="preserve" text-anchor="middle" x="5854.85" y="-604.75" font-family="Arial" font-size="32.00">Detokenize:</text>
<text xml:space="preserve" text-anchor="middle" x="5854.85" y="-568" font-family="Arial" font-size="32.00">output_text = tokenizer.decode(output_id)</text>
</g>
<!-- ARGMAX&#45;&gt;DETOK -->
<g id="edge26" class="edge">
<title>ARGMAX&#45;&gt;DETOK</title>
<path fill="none" stroke="black" d="M5513.63,-598.4C5521.84,-598.4 5530.14,-598.4 5538.51,-598.4"/>
<polygon fill="black" stroke="black" points="5538.44,-601.9 5548.44,-598.4 5538.44,-594.9 5538.44,-601.9"/>
</g>
<!-- OUT0 -->
<g id="node16" class="node">
<title>OUT0</title>
<polygon fill="#c2ffc2" stroke="black" points="6456.98,-641.6 6196.48,-641.6 6196.48,-555.2 6456.98,-555.2 6456.98,-641.6"/>
<text xml:space="preserve" text-anchor="middle" x="6326.73" y="-586.37" font-family="Arial" font-size="32.00">Output Token 0: I</text>
</g>
<!-- DETOK&#45;&gt;OUT0 -->
<g id="edge27" class="edge">
<title>DETOK&#45;&gt;OUT0</title>
<path fill="none" stroke="black" d="M6159.74,-598.4C6168.26,-598.4 6176.66,-598.4 6184.87,-598.4"/>
<polygon fill="black" stroke="black" points="6184.84,-601.9 6194.84,-598.4 6184.84,-594.9 6184.84,-601.9"/>
</g>
<!-- OUT0&#45;&gt;Qgen -->
<g id="edge29" class="edge">
<title>OUT0&#45;&gt;Qgen</title>
<path fill="none" stroke="#666666" stroke-dasharray="5,2" d="M6196.31,-556.52C6183.91,-552.93 6171.48,-549.49 6159.48,-546.4 5019.46,-252.52 4735.47,-134.77 3564.15,-16.4 3398.77,0.32 3354.4,9.14 3190.15,-16.4 3130.74,-25.63 3066.78,-45.07 3014.48,-63.61"/>
<polygon fill="#666666" stroke="#666666" points="3013.5,-60.25 3005.27,-66.92 3015.86,-66.84 3013.5,-60.25"/>
<text xml:space="preserve" text-anchor="middle" x="4445.23" y="-157.5" font-family="Arial" font-size="24.00">Token Generation Loop</text>
</g>
<!-- OUT1 -->
<g id="node17" class="node">
<title>OUT1</title>
<polygon fill="#c2ffc2" stroke="black" points="6928.23,-641.6 6631.73,-641.6 6631.73,-555.2 6928.23,-555.2 6928.23,-641.6"/>
<text xml:space="preserve" text-anchor="middle" x="6779.98" y="-586.37" font-family="Arial" font-size="32.00">Output Token 1: am</text>
</g>
<!-- OUT0&#45;&gt;OUT1 -->
<g id="edge28" class="edge">
<title>OUT0&#45;&gt;OUT1</title>
<path fill="none" stroke="black" stroke-dasharray="5,2" d="M6457.34,-598.4C6508.15,-598.4 6566.95,-598.4 6620.26,-598.4"/>
<polygon fill="black" stroke="black" points="6620.04,-601.9 6630.04,-598.4 6620.04,-594.9 6620.04,-601.9"/>
<text xml:space="preserve" text-anchor="middle" x="6544.35" y="-603.3" font-family="Arial" font-size="28.00">next output</text>
</g>
<!-- legend -->
<g id="node18" class="node">
<title>legend</title>
<polygon fill="#ffffff" stroke="none" points="8,-580.02 8,-1254.77 595.75,-1254.77 595.75,-580.02 8,-580.02"/>
<polygon fill="none" stroke="black" points="9,-1202.02 9,-1253.77 594.75,-1253.77 594.75,-1202.02 9,-1202.02"/>
<text xml:space="preserve" text-anchor="start" x="89.25" y="-1213.77" font-family="Arial" font-weight="bold" font-size="40.00">Legend: Color Coding</text>
<polygon fill="#ffe4b2" stroke="none" points="9,-1150.27 9,-1202.02 278.25,-1202.02 278.25,-1150.27 9,-1150.27"/>
<polygon fill="none" stroke="black" points="9,-1150.27 9,-1202.02 278.25,-1202.02 278.25,-1150.27 9,-1150.27"/>
<text xml:space="preserve" text-anchor="start" x="39.38" y="-1161.02" font-family="Arial" font-size="40.00">Input Token</text>
<polygon fill="none" stroke="black" points="278.25,-1150.27 278.25,-1202.02 594.75,-1202.02 594.75,-1150.27 278.25,-1150.27"/>
<text xml:space="preserve" text-anchor="start" x="316.12" y="-1161.02" font-family="Arial" font-size="40.00">how, are, you</text>
<polygon fill="#b2e4ff" stroke="none" points="9,-1098.52 9,-1150.27 278.25,-1150.27 278.25,-1098.52 9,-1098.52"/>
<polygon fill="none" stroke="black" points="9,-1098.52 9,-1150.27 278.25,-1150.27 278.25,-1098.52 9,-1098.52"/>
<text xml:space="preserve" text-anchor="start" x="41.62" y="-1109.27" font-family="Arial" font-size="40.00">Embedding</text>
<polygon fill="none" stroke="black" points="278.25,-1098.52 278.25,-1150.27 594.75,-1150.27 594.75,-1098.52 278.25,-1098.52"/>
<text xml:space="preserve" text-anchor="start" x="321.75" y="-1109.27" font-family="Arial" font-size="40.00">Token vector</text>
<polygon fill="#ffd1dc" stroke="none" points="9,-1046.77 9,-1098.52 278.25,-1098.52 278.25,-1046.77 9,-1046.77"/>
<polygon fill="none" stroke="black" points="9,-1046.77 9,-1098.52 278.25,-1098.52 278.25,-1046.77 9,-1046.77"/>
<text xml:space="preserve" text-anchor="start" x="88.88" y="-1057.52" font-family="Arial" font-size="40.00">Query</text>
<polygon fill="none" stroke="black" points="278.25,-1046.77 278.25,-1098.52 594.75,-1098.52 594.75,-1046.77 278.25,-1046.77"/>
<text xml:space="preserve" text-anchor="start" x="324.38" y="-1057.52" font-family="Arial" font-size="40.00">Q (attention)</text>
<polygon fill="#e6b2ff" stroke="none" points="9,-995.02 9,-1046.77 278.25,-1046.77 278.25,-995.02 9,-995.02"/>
<polygon fill="none" stroke="black" points="9,-995.02 9,-1046.77 278.25,-1046.77 278.25,-995.02 9,-995.02"/>
<text xml:space="preserve" text-anchor="start" x="108.75" y="-1005.77" font-family="Arial" font-size="40.00">Key</text>
<polygon fill="none" stroke="black" points="278.25,-995.02 278.25,-1046.77 594.75,-1046.77 594.75,-995.02 278.25,-995.02"/>
<text xml:space="preserve" text-anchor="start" x="326.25" y="-1005.77" font-family="Arial" font-size="40.00">K (attention)</text>
<polygon fill="#b2ffb2" stroke="none" points="9,-943.27 9,-995.02 278.25,-995.02 278.25,-943.27 9,-943.27"/>
<polygon fill="none" stroke="black" points="9,-943.27 9,-995.02 278.25,-995.02 278.25,-943.27 9,-943.27"/>
<text xml:space="preserve" text-anchor="start" x="93.38" y="-954.02" font-family="Arial" font-size="40.00">Value</text>
<polygon fill="none" stroke="black" points="278.25,-943.27 278.25,-995.02 594.75,-995.02 594.75,-943.27 278.25,-943.27"/>
<text xml:space="preserve" text-anchor="start" x="326.25" y="-954.02" font-family="Arial" font-size="40.00">V (attention)</text>
<polygon fill="#e0e0ff" stroke="none" points="9,-891.52 9,-943.27 278.25,-943.27 278.25,-891.52 9,-891.52"/>
<polygon fill="none" stroke="black" points="9,-891.52 9,-943.27 278.25,-943.27 278.25,-891.52 9,-891.52"/>
<text xml:space="preserve" text-anchor="start" x="36.75" y="-902.27" font-family="Arial" font-size="40.00">Dot Product</text>
<polygon fill="none" stroke="black" points="278.25,-891.52 278.25,-943.27 594.75,-943.27 594.75,-891.52 278.25,-891.52"/>
<text xml:space="preserve" text-anchor="start" x="328.5" y="-902.27" font-family="Arial" font-size="40.00">Q·K = score</text>
<polygon fill="#ffe0e0" stroke="none" points="9,-839.77 9,-891.52 278.25,-891.52 278.25,-839.77 9,-839.77"/>
<polygon fill="none" stroke="black" points="9,-839.77 9,-891.52 278.25,-891.52 278.25,-839.77 9,-839.77"/>
<text xml:space="preserve" text-anchor="start" x="69.75" y="-850.52" font-family="Arial" font-size="40.00">Softmax</text>
<polygon fill="none" stroke="black" points="278.25,-839.77 278.25,-891.52 594.75,-891.52 594.75,-839.77 278.25,-839.77"/>
<text xml:space="preserve" text-anchor="start" x="282.38" y="-850.52" font-family="Arial" font-size="40.00">Attention weights</text>
<polygon fill="#e0ffe0" stroke="none" points="9,-788.02 9,-839.77 278.25,-839.77 278.25,-788.02 9,-788.02"/>
<polygon fill="none" stroke="black" points="9,-788.02 9,-839.77 278.25,-839.77 278.25,-788.02 9,-788.02"/>
<text xml:space="preserve" text-anchor="start" x="12" y="-798.77" font-family="Arial" font-size="40.00">Weighted Sum</text>
<polygon fill="none" stroke="black" points="278.25,-788.02 278.25,-839.77 594.75,-839.77 594.75,-788.02 278.25,-788.02"/>
<text xml:space="preserve" text-anchor="start" x="353.25" y="-798.77" font-family="Arial" font-size="40.00">Σ w_i V_i</text>
<polygon fill="#e0f7fa" stroke="none" points="9,-736.27 9,-788.02 278.25,-788.02 278.25,-736.27 9,-736.27"/>
<polygon fill="none" stroke="black" points="9,-736.27 9,-788.02 278.25,-788.02 278.25,-736.27 9,-736.27"/>
<text xml:space="preserve" text-anchor="start" x="89.62" y="-747.02" font-family="Arial" font-size="40.00">Logits</text>
<polygon fill="none" stroke="black" points="278.25,-736.27 278.25,-788.02 594.75,-788.02 594.75,-736.27 278.25,-736.27"/>
<text xml:space="preserve" text-anchor="start" x="291.38" y="-747.02" font-family="Arial" font-size="40.00">Project to vocab</text>
<polygon fill="#f0e0fa" stroke="none" points="9,-684.52 9,-736.27 278.25,-736.27 278.25,-684.52 9,-684.52"/>
<polygon fill="none" stroke="black" points="9,-684.52 9,-736.27 278.25,-736.27 278.25,-684.52 9,-684.52"/>
<text xml:space="preserve" text-anchor="start" x="74.25" y="-695.27" font-family="Arial" font-size="40.00">Argmax</text>
<polygon fill="none" stroke="black" points="278.25,-684.52 278.25,-736.27 594.75,-736.27 594.75,-684.52 278.25,-684.52"/>
<text xml:space="preserve" text-anchor="start" x="281.25" y="-695.27" font-family="Arial" font-size="40.00">Pick output token</text>
<polygon fill="#f0fff0" stroke="none" points="9,-632.77 9,-684.52 278.25,-684.52 278.25,-632.77 9,-632.77"/>
<polygon fill="none" stroke="black" points="9,-632.77 9,-684.52 278.25,-684.52 278.25,-632.77 9,-632.77"/>
<text xml:space="preserve" text-anchor="start" x="42.38" y="-643.52" font-family="Arial" font-size="40.00">Detokenize</text>
<polygon fill="none" stroke="black" points="278.25,-632.77 278.25,-684.52 594.75,-684.52 594.75,-632.77 278.25,-632.77"/>
<text xml:space="preserve" text-anchor="start" x="304.88" y="-643.52" font-family="Arial" font-size="40.00">Convert to text</text>
<polygon fill="#c2ffc2" stroke="none" points="9,-581.02 9,-632.77 278.25,-632.77 278.25,-581.02 9,-581.02"/>
<polygon fill="none" stroke="black" points="9,-581.02 9,-632.77 278.25,-632.77 278.25,-581.02 9,-581.02"/>
<text xml:space="preserve" text-anchor="start" x="24" y="-591.77" font-family="Arial" font-size="40.00">Output Token</text>
<polygon fill="none" stroke="black" points="278.25,-581.02 278.25,-632.77 594.75,-632.77 594.75,-581.02 278.25,-581.02"/>
<text xml:space="preserve" text-anchor="start" x="363.38" y="-591.77" font-family="Arial" font-size="40.00">&quot;I&quot;, &quot;am&quot;</text>
<polygon fill="none" stroke="black" points="8,-580.02 8,-1254.77 595.75,-1254.77 595.75,-580.02 8,-580.02"/>
</g>
<!-- descriptions -->
<g id="node19" class="node">
<title>descriptions</title>
<polygon fill="#ffffff" stroke="none" points="752.75,-656.52 752.75,-1178.27 2281,-1178.27 2281,-656.52 752.75,-656.52"/>
<polygon fill="none" stroke="black" points="753.75,-1130.02 753.75,-1177.27 2280,-1177.27 2280,-1130.02 753.75,-1130.02"/>
<text xml:space="preserve" text-anchor="start" x="1407.75" y="-1141.07" font-family="Arial" font-weight="bold" font-size="36.00">Descriptions</text>
<polygon fill="none" stroke="black" points="753.75,-1082.77 753.75,-1130.02 1030.5,-1130.02 1030.5,-1082.77 753.75,-1082.77"/>
<text xml:space="preserve" text-anchor="start" x="756.75" y="-1093.82" font-family="Arial" font-weight="bold" font-size="36.00">Dot(Q, K)</text>
<polygon fill="none" stroke="black" points="1030.5,-1082.77 1030.5,-1130.02 2280,-1130.02 2280,-1082.77 1030.5,-1082.77"/>
<text xml:space="preserve" text-anchor="start" x="1033.5" y="-1092.82" font-family="Arial" font-size="36.00">Dot product of query and key vectors (similarity score)</text>
<polygon fill="none" stroke="black" points="753.75,-1035.52 753.75,-1082.77 1030.5,-1082.77 1030.5,-1035.52 753.75,-1035.52"/>
<text xml:space="preserve" text-anchor="start" x="756.75" y="-1046.57" font-family="Arial" font-weight="bold" font-size="36.00">Softmax</text>
<polygon fill="none" stroke="black" points="1030.5,-1035.52 1030.5,-1082.77 2280,-1082.77 2280,-1035.52 1030.5,-1035.52"/>
<text xml:space="preserve" text-anchor="start" x="1033.5" y="-1045.57" font-family="Arial" font-size="36.00">Normalizes scores to probabilities (weights)</text>
<polygon fill="none" stroke="black" points="753.75,-988.27 753.75,-1035.52 1030.5,-1035.52 1030.5,-988.27 753.75,-988.27"/>
<text xml:space="preserve" text-anchor="start" x="756.75" y="-999.32" font-family="Arial" font-weight="bold" font-size="36.00">Weighted sum</text>
<polygon fill="none" stroke="black" points="1030.5,-988.27 1030.5,-1035.52 2280,-1035.52 2280,-988.27 1030.5,-988.27"/>
<text xml:space="preserve" text-anchor="start" x="1033.5" y="-998.32" font-family="Arial" font-size="36.00">Each value vector V is weighted by its attention score</text>
<polygon fill="none" stroke="black" points="753.75,-941.02 753.75,-988.27 1030.5,-988.27 1030.5,-941.02 753.75,-941.02"/>
<text xml:space="preserve" text-anchor="start" x="756.75" y="-952.07" font-family="Arial" font-weight="bold" font-size="36.00">Project to logits</text>
<polygon fill="none" stroke="black" points="1030.5,-941.02 1030.5,-988.27 2280,-988.27 2280,-941.02 1030.5,-941.02"/>
<text xml:space="preserve" text-anchor="start" x="1033.5" y="-951.07" font-family="Arial" font-size="36.00">Weighted sum is projected to vocabulary size (one score per token)</text>
<polygon fill="none" stroke="black" points="753.75,-893.77 753.75,-941.02 1030.5,-941.02 1030.5,-893.77 753.75,-893.77"/>
<text xml:space="preserve" text-anchor="start" x="756.75" y="-904.82" font-family="Arial" font-weight="bold" font-size="36.00">Argmax</text>
<polygon fill="none" stroke="black" points="1030.5,-893.77 1030.5,-941.02 2280,-941.02 2280,-893.77 1030.5,-893.77"/>
<text xml:space="preserve" text-anchor="start" x="1033.5" y="-903.82" font-family="Arial" font-size="36.00">Selects the token with the highest score</text>
<polygon fill="none" stroke="black" points="753.75,-846.52 753.75,-893.77 1030.5,-893.77 1030.5,-846.52 753.75,-846.52"/>
<text xml:space="preserve" text-anchor="start" x="756.75" y="-857.57" font-family="Arial" font-weight="bold" font-size="36.00">Detokenize</text>
<polygon fill="none" stroke="black" points="1030.5,-846.52 1030.5,-893.77 2280,-893.77 2280,-846.52 1030.5,-846.52"/>
<text xml:space="preserve" text-anchor="start" x="1033.5" y="-856.57" font-family="Arial" font-size="36.00">Converts token ID to readable text</text>
<polygon fill="none" stroke="black" points="753.75,-799.27 753.75,-846.52 1030.5,-846.52 1030.5,-799.27 753.75,-799.27"/>
<text xml:space="preserve" text-anchor="start" x="756.75" y="-810.32" font-family="Arial" font-weight="bold" font-size="36.00">Attention</text>
<polygon fill="none" stroke="black" points="1030.5,-799.27 1030.5,-846.52 2280,-846.52 2280,-799.27 1030.5,-799.27"/>
<text xml:space="preserve" text-anchor="start" x="1033.5" y="-809.32" font-family="Arial" font-size="36.00">softmax((Q·K^T)/√d_k) V</text>
<polygon fill="none" stroke="black" points="753.75,-752.02 753.75,-799.27 1030.5,-799.27 1030.5,-752.02 753.75,-752.02"/>
<text xml:space="preserve" text-anchor="start" x="756.75" y="-763.07" font-family="Arial" font-weight="bold" font-size="36.00">Query (Q)</text>
<polygon fill="none" stroke="black" points="1030.5,-752.02 1030.5,-799.27 2280,-799.27 2280,-752.02 1030.5,-752.02"/>
<text xml:space="preserve" text-anchor="start" x="1033.5" y="-762.07" font-family="Arial" font-size="36.00">Query vector: what we search for (current decoder/query vector). Q = x · W_Q</text>
<polygon fill="none" stroke="black" points="753.75,-704.77 753.75,-752.02 1030.5,-752.02 1030.5,-704.77 753.75,-704.77"/>
<text xml:space="preserve" text-anchor="start" x="756.75" y="-715.82" font-family="Arial" font-weight="bold" font-size="36.00">Key (K)</text>
<polygon fill="none" stroke="black" points="1030.5,-704.77 1030.5,-752.02 2280,-752.02 2280,-704.77 1030.5,-704.77"/>
<text xml:space="preserve" text-anchor="start" x="1033.5" y="-714.82" font-family="Arial" font-size="36.00">Key vector: address/signature of a context token. K = x · W_K</text>
<polygon fill="none" stroke="black" points="753.75,-657.52 753.75,-704.77 1030.5,-704.77 1030.5,-657.52 753.75,-657.52"/>
<text xml:space="preserve" text-anchor="start" x="756.75" y="-668.57" font-family="Arial" font-weight="bold" font-size="36.00">Value (V)</text>
<polygon fill="none" stroke="black" points="1030.5,-657.52 1030.5,-704.77 2280,-704.77 2280,-657.52 1030.5,-657.52"/>
<text xml:space="preserve" text-anchor="start" x="1033.5" y="-667.57" font-family="Arial" font-size="36.00">Value vector: content retrieved when a Key matches. V = x · W_V</text>
<polygon fill="none" stroke="black" points="752.75,-656.52 752.75,-1178.27 2281,-1178.27 2281,-656.52 752.75,-656.52"/>
</g>
<!-- legend&#45;&gt;descriptions -->
<!-- legend&#45;&gt;descriptions -->
</g>
</svg>
