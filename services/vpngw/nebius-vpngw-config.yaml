# GCP Classic VPN Test Configuration
# Testing with static routing (GCP Classic VPN does not support BGP)
version: 1
tenant_id: "tenant-e00f3wdfzwfjgbcyfv"
project_id: "project-e01y6xs5pr00gsdsyay8wq"
region_id: "eu-west1" # e.g., us-central1 | eu-north1 | eu-north2 | eu-west1

gateway_group:
  name: "nebius-vpn-gw"
  instance_count: 1

  # Per-instance external IPs (optional)
  # Omit to auto-create allocations for testing
  # Uncomment to use specific allocation IPs:
  # external_ips:
  #   - ["1.2.3.4"]  # Instance 0, NIC 0

  vm_spec:
    platform: "cpu-d3"
    preset: "32vcpu-128gb"
    disk_boot_image: ubuntu24.04-driverless
    disk_gb: 200
    disk_type: network_ssd
    disk_block_bytes: 4096
    num_nics: 1
    ssh_public_key_path: "~/.ssh/id_ed25519.pub"
    ssh_private_key_path: "~/.ssh/id_ed25519"
    network_id: "${NETWORK_ID}"

gateway:
  local_asn: 65010 # Not used for static routing, but required in config
  # Local prefixes: Nebius-side subnets to advertise to GCP
  # Replace with your actual Nebius VPC CIDR(s)
  local_prefixes:
  - 10.49.0.0/16 # Example: Replace with your Nebius VPC subnet
  quotas:
    max_connections: 1
    max_tunnels: 2
    max_total_bandwidth_mbps: null

defaults:
  vpn_type: ipsec
  ike_version: 2
  allow_ikev1: true
  auth:
    method: psk
  crypto:
    # GCP Classic VPN default ciphers (compatible)
    ike_proposals: [ "aes256-sha256-modp2048" ]
    ike_lifetime_seconds: 28800 # 8 hours (GCP default: 8h)
    esp_proposals: [ "aes256-sha256" ]
    esp_lifetime_seconds: 3600 # 1 hour (GCP default: 1h)
    dh_groups: [ 14 ] # modp2048 (GCP default)
  dpd:
    interval_seconds: 30
    timeout_seconds: 120
  routing:
    mode: static # Changed from 'bgp' to 'static' for GCP Classic VPN

# GCP Classic VPN Connection
connections:
- name: "gcp-classic-vpn-test"
  description: "GCP Classic VPN with static routing"
  vendor: "gcp"
  routing_mode: static # GCP Classic VPN does not support BGP

  tunnels:
  - name: "gcp-classic-tunnel-0"
    gateway_instance_index: 0
    ha_role: "active"
    ike_version: 2 # IKEv2 (GCP default)
    remote_public_ip: "34.155.169.244" # Your GCP VPN Gateway public IP
    psk: "${GCP_TUNNEL_PSK}" # Set via environment variable: export GCP_TUNNEL_PSK="your-shared-secret"

    # Static routing configuration
    static_routes:
      # Remote prefixes: GCP VPC subnet(s) that you want to reach
      # Replace with your actual GCP VPC CIDR(s)
      remote_prefixes:
      - "10.10.0.0/24" # Example: Replace with your GCP VPC subnet
      # Local prefixes: Optional override (omit to use gateway.local_prefixes)
      # Uncomment to override for this specific tunnel:
      # local_prefixes:
      #   - "10.0.0.0/16"
